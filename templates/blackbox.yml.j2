- labels:
    module: icmpcheck
  targets:
    {% for host in groups[prometheus_monitored_group] -%}
    - {{ hostvars[groups[prometheus_admin_group][0]]['ansible_'+prometheus_admin_iface]['ipv4']['address'] }}=>{{ hostvars[host]['ansible_'+prometheus_monitored_iface]['ipv4']['address'] }}
    {% endfor %}

- labels:
    module: tcpcheck
  targets:
    {% for host in groups[prometheus_monitored_group] -%}
    {%- set loop_next = groups[prometheus_monitored_group][0 if loop.last else loop.index] -%}
    {% for sc, ports in hostvars[loop_next]['bb_service_ports'].items() -%}
    {% for port in ports -%}
    - {{ hostvars[host]['ansible_'+prometheus_monitored_iface]['ipv4']['address'] }}=>{{ hostvars[loop_next]['ansible_'+prometheus_monitored_iface]['ipv4']['address'] }}:{{ port }}
    {% endfor %}
    {%- endfor %}
    {%- endfor %}

- labels:
    module: metax
  targets:
    {% for host in groups[prometheus_monitored_group] -%}
    {%- set loop_next = groups[prometheus_monitored_group][0 if loop.last else loop.index] -%}
    {% for sc, ports in hostvars[loop_next]['bb_service_ports'].items() if sc.startswith('meta') -%}
    {% for port in ports -%}
    - {{ hostvars[host]['ansible_'+prometheus_monitored_iface]['ipv4']['address'] }}=>{{hostvars[loop_next]['ansible_'+prometheus_monitored_iface]['ipv4']['address']}}:{{hostvars[loop_next]['bb_service_ports']['oioproxy'][0]}},{{ hostvars[loop_next]['ansible_'+prometheus_monitored_iface]['ipv4']['address'] }}:{{ port }}
    {% endfor %}
    {%- endfor %}
    {%- endfor %}

- labels:
    module: account
  targets:
    {% for host in groups[prometheus_monitored_group] -%}
    {%- set loop_next = groups[prometheus_monitored_group][0 if loop.last else loop.index] -%}
    {% for port in hostvars[loop_next]['bb_service_ports']['account'] -%}
    - {{ hostvars[host]['ansible_'+prometheus_monitored_iface]['ipv4']['address'] }}=>{{ hostvars[loop_next]['ansible_'+prometheus_monitored_iface]['ipv4']['address'] }}:{{ port }}
    {% endfor %}
    {%- endfor %}

- labels:
    module: oioproxy
  targets:
    {% for host in groups[prometheus_monitored_group] -%}
    {%- set loop_next = groups[prometheus_monitored_group][0 if loop.last else loop.index] -%}
    {% for port in hostvars[loop_next]['bb_service_ports']['oioproxy'] -%}
    - {{ hostvars[host]['ansible_'+prometheus_monitored_iface]['ipv4']['address'] }}=>{{ hostvars[loop_next]['ansible_'+prometheus_monitored_iface]['ipv4']['address'] }}:{{ port }}
    {% endfor %}
    {%- endfor %}

- labels:
    module: rawx
  targets:
    {% for host in groups[prometheus_monitored_group] -%}
    {%- set loop_next = groups[prometheus_monitored_group][0 if loop.last else loop.index] -%}
    {% for port in hostvars[loop_next]['bb_service_ports']['rawx'] -%}
    - {{ hostvars[host]['ansible_'+prometheus_monitored_iface]['ipv4']['address'] }}=>{{ hostvars[loop_next]['ansible_'+prometheus_monitored_iface]['ipv4']['address'] }}:{{ port }}
    {% endfor %}
    {%- endfor %}
